<html>
  <head>
    <title>Clatch</title>
    <script src="lib/react-0.10.0.js"></script>
    <script src="lib/JSXTransformer-0.10.0.js"></script>
    <script src="lib/jquery-2.1.0.js"></script>
    <script src="lib/director.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <div id="content"></div>
    <script type="text/jsx" src="logdisplay.jsx"></script>
    <script type="text/jsx" src="logentryform.jsx"></script>
    <script type="text/jsx">
      /**
       * @jsx React.DOM
       */
      
      (function() {
          var clatch = {};
          clatch.loglist = 'loglist';
          clatch.newlog = 'newlog';
          clatch.editlog = 'editlog';

          var Clatch = React.createClass({
            getInitialState: function() {
                return {nowShowing: 'loglist'};
            },

            componentDidMount: function () {
                var setState = this.setState;
                var boundSetState = setState.bind(this);

                var router = Router({
                    '/': setState.bind(this, {nowShowing: clatch.loglist}),
                    '/log/new': setState.bind(this, {nowShowing: clatch.newlog}),
                    '/log/edit/:id': function(id) { 
                                            boundSetState({nowShowing: clatch.editlog,
                                                           id: id}); 
                                        }
                    });
                router.init('/');
            },

            render: function() {
                console.log(this.state.nowShowing);
                if (this.state.nowShowing === clatch.loglist) {
                    return <LogDisplay entries={this.props.data}/>;
                } else if (this.state.nowShowing === clatch.newlog) {
                    return <LogForm />;
                } else if (this.state.nowShowing === clatch.editlog) {
                    var id = parseInt(this.state.id, 10);
                    var entry = this.props.data.filter(function(entry) { return entry['id'] === id; });
                    return <LogForm entry={entry[0]} id={this.state.id} />;
                }
            }
          });


          var entries = [
            {id: 1,
             body: 'rock your body', 
             tags: ['butt', 'IsItWorthItLetMeWorkIt'], 
             pages: ['Silk', 'Dragons'], 
             datetime: "07 Apr 2014 08:45"},

            {id: 2,
             body: 'dis be body 2', 
             tags: ['peace', 'JustDoIt', 'butt'], 
             pages: ['Rainbows'], datetime: "20 Apr 2014 07:06"}
          ];

          React.renderComponent(
            <Clatch data={entries}/>,
            document.getElementById('content')
          );

    })();
    </script>
  </body>
</html>
